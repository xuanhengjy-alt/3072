## PRD：3072推数字游戏（Web H5）

### 背景与目标
- **目标**: 基于 HTML5、JavaScript、Tailwind CSS，实现可在浏览器端游玩的 5×5 益智合成类游戏，达成 3072 获胜。
- **用户**: 休闲玩家、数字合成类游戏爱好者。
- **平台**: 现代桌面与移动浏览器（Chrome、Safari、Edge、Firefox）。

### 范围
- **在范围内**: 玩法逻辑、UI 界面、交互控制、胜负判定、步数统计、基础动画、音效开关（可选）。
- **不在范围内**: 登录/排行/社交、服务端存档、多语言。

### 术语
- **棋盘**: 5×5 网格，坐标从左上到右下（1,1）至（5,5）。
- **数字卡片**: 填充在格子中的方块，显示 3 的倍数（3、6、12、…）。
- **一步**: 玩家一次方向操作（上/下/左/右）。

### 玩法规则（权威定义）
1. **棋盘**: 初始化 5×5 空棋盘，坐标如（1,1）…（5,5）。
2. **初始生成**: 游戏开始时，随机在 2 个空格生成数字卡片 3。
3. **回合生成**: 每次玩家成功进行一次方向移动后，随机在 1 个空格生成数字卡片 3。
4. **操作方式**:
   - 棋盘下方有 4 个按钮：**上、下、左、右**。支持键盘方向键与滑动手势（移动端）。
   - 触发后，棋盘上全部数字卡片向所指方向**滑动到底**（直至遇边界或其他卡片）。
5. **合并规则**:
   - 一个格子最多容纳 1 张卡片。
   - 同一行/列中，朝移动方向相邻的两个相同数字卡片会合并为它们的和（例如 3+3→6，6+6→12）。
   - 每个卡片在一次移动动作中最多参与一次合并。
   - 合并发生后，合并结果卡片继续随队列向指令方向移动到极限位置。
6. **胜利判定**: 任意格子出现 **3072** 时，立即判定胜利，弹窗提示“恭喜获胜”，显示累计步数，提供“再来一局”重新开始。
7. **失败判定**: 棋盘无空格且所有相邻（上/下/左/右）格子数字都不相同，判定失败，弹窗“Game Over”，提供“再来一局”重新开始。
8. **重新开始**: 顶部“重新开始”按钮可随时重置游戏。

### 目标体验与非功能需求
- **响应**: 操作到动画开始 ≤ 80ms；动画时长 120–180ms，可配置。
- **跨端**: 支持移动端触屏滑动、桌面端键盘与点击按钮。
- **可访问**: 按钮可聚焦，支持键盘 Enter/Space 触发，ARIA 标签。
- **持久化**: 自动本地存储当前棋盘与步数（localStorage），刷新可恢复。
- **无广告/无内购**（本期）。

### 界面信息架构
- **顶部栏**:
  - 标题：3072推数字游戏
  - 按钮：重新开始
  - 状态：步数（累计）
- **棋盘区**:
  - 5×5 网格；空格为浅底色，占位边框。
  - 数字卡片：圆角方块，按数值分级配色与字号。
- **操作区**:
  - 四向按钮：上、下、左、右。
  - 移动端显示为方向键布局；桌面端保留按钮与键盘提示。
- **弹窗**:
  - 胜利：文案“恭喜获胜”，显示步数，“再来一局”。
  - 失败：文案“Game Over”，“再来一局”。

### 交互细节
- **输入**:
  - 点击四向按钮、键盘方向键、移动端四向滑动（阈值 30px、最短时长 50ms）。
- **反馈**:
  - 移动动画：卡片位移过渡。
  - 合并动画：轻微放大/闪烁强调（不影响判定）。
  - 新生成 3：淡入/缩放进入。
- **不可移动**:
  - 若该方向无任何变化，不生成新卡片，不计步，不播放动画。
- **步数统计**:
  - 只在“产生实际位移或合并”的有效移动后 +1。
- **无障碍**:
  - 按钮支持键盘与屏幕阅读器；提示文本可通过 `aria-live` 通知关键事件（合并、胜负）。

### 逻辑与算法（概要）
- **数据结构**:
  - `board`: 二维数组 5×5，空为 0，非空为整数（3 的倍数）。
  - `moves`: 整数步数。
- **初始化**:
  - 清空 `board`，随机生成 2 个 3，`moves=0`。
- **移动流程（以“左移”为例）**:
  - 对每一行：提取非 0 列表 → 从左到右压缩与合并（相同则合并一次）→ 用 0 填充至长度 5 → 写回。
  - 其他方向通过旋转/转置实现复用。
  - 若任一行/列发生变化，记为有效移动：`moves++`，随机空位生成 1 个 3。
- **合并约束**:
  - 单次移动中，同一位置合并后产生的新卡片不能再次合并。
- **随机生成**:
  - 收集所有空位，等概率选择 1 个，填入 3（初始为 2 个）。
- **胜负判断**:
  - 胜利：扫描 `board` 是否包含 3072。
  - 失败：若无空位，且对任一格，其上下左右均不存在相同值，则失败。

### 视觉与样式（Tailwind）
- **棋盘**: `grid grid-cols-5 gap-2 p-3 rounded-lg bg-gray-200`
- **空格**: `w-full aspect-square rounded bg-gray-300`
- **卡片**: `flex items-center justify-center font-bold rounded shadow`
  - 小值配浅色，高值配深色，确保对比度（WCAG AA）。
- **按钮**: `btn` 基类（圆角、阴影、按压态），方向键布局：`grid grid-cols-3`（上居中、左右、下居中）。

### 文案
- **标题**: 3072推数字游戏
- **按钮**: 上、下、左、右、重新开始、再来一局
- **弹窗**:
  - 胜利：恭喜获胜
  - 失败：Game Over
  - 步数展示：本局用时 X 步

### 埋点（可选）
- `game_start`、`move`（含方向、是否合并、生成位置）、`win`（步数）、`lose`（步数）、`restart`。

### 错误与边界
- 多点触控时忽略额外触点，以首次方向为准。
- 输入节流：一次移动过程内忽略新输入，直至动画结束。
- localStorage 不可用时，不中断游戏，仅不进行持久化。

### 兼容性
- 支持最新两代主流浏览器；移动端 Safari/Chrome。
- 降级策略：不支持 `prefers-reduced-motion` 时减少动画复杂度。

### 验收标准
- 初始棋盘出现两个“3”，位置随机。
- 合法移动必定触发至少一个卡片移动或合并，并生成一个新的“3”。
- 单次移动中，同一条线的同级相邻相同数字只合并一次。
- 达到 3072 即弹胜利窗，显示步数且可重开。
- 棋盘满且无可合并时弹失败窗且可重开。
- “重新开始”随时可用，重置步数与棋盘。
- 支持点击按钮、键盘方向键、移动端滑动三种输入。
- 刷新后可恢复上次棋盘与步数（若存储可用）。

### 里程碑
- M1：核心逻辑与判定（棋盘、移动、合并、胜负）完成。
- M2：UI/动画（Tailwind 样式、移动/合并/生成动画、响应式）。
- M3：输入与可访问（按钮/键盘/滑动、ARIA、节流）。
- M4：持久化与弹窗、重新开始与再来一局流程。
- M5：优化与验收（性能调优、适配测试、Bug 修复）。
